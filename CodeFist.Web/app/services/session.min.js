(function(){var n,t=[].slice;n=angular.module("codefist");n.factory("session",["$http","$rootScope","$window","urls",function(n,i,r,u){var f;return f={user:{},isLoggedIn:function(){return!!this.user.enabled},isLoading:function(){return!!this.request||!!this.loginWindow},login:function(n,t){var i,r,f;return n==null&&(n=1e3),t==null&&(t=650),t=Math.min(t,screen.height),n=Math.min(n,screen.width),i=screen.width>n?Math.round(screen.width/2-n/2):0,r=screen.height>t?Math.round(screen.height/2-t/2):0,f="left="+i+",top="+r+",width="+n+",height="+t+",personalbar=0,toolbar=0,scrollbars=1,resizable=1",this.loginWindow=window.open(u.login,"Sign in with Github",f),this.loginWindow?this.loginWindow.focus():void 0},logout:function(){var i;return i=this,n({url:u.logout}).then(function(){return i.processLoginResult({success:!1})})["catch"](function(){return console.error.apply(console,["Error logging out"].concat(t.call(arguments)))})},processLoginResult:function(n){return this.user=n.success?{name:n.userDisplayName,id:n.userId,enabled:n.enabled}:{}},checkLoginStatus:function(){var t;return t=this,n({url:u.loginStatus,method:"POST"}).then(function(n){return t.processLoginResult(n.data)})},initializeScope:function(n){var t;return t=this,n.isLoggedIn=function(){return t.isLoggedIn()},n.isLoading=function(){return t.isLoading()},n.username=function(){return t.user.name}}},r._handleLoginResponse=function(n){return i.$apply(function(){return f.processLoginResult(n)}),delete f.loginWindow},f.checkLoginStatus(),setInterval(f.checkLoginStatus.bind(f),3e5),f}])}).call(this)